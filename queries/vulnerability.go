package queries

import "github.com/shurcooL/githubv4"

/*
query {
      repository(owner:"${repositoryOwner}" name:"${repositoryName}") {
        vulnerabilityAlerts(last: ${count}) {
          edges {
            node {
              id
              dismissedAt
              fixedAt
              repository {
                name
                owner {
                  login
                }
              }
              securityAdvisory {
                id
                description
                cvss {
                  score
                  vectorString
                }
                permalink
                severity
                summary
              }
              securityVulnerability {
                firstPatchedVersion {
                  identifier
                }
                package {
                  ecosystem
                  name
                }
                vulnerableVersionRange
                advisory {
                  cvss {
                    score
                    vectorString
                  }
                  summary
                }
              }
            }
          }
        }
      }
    }
*/
// VulnerabilityQuery query
var VulnerabilityQuery struct {
	Repository struct {
		VulnerabilityAlerts []struct {
			Nodes []struct {
				ID          *githubv4.ID       `graphql:"id"`
				DismissedAt *githubv4.DateTime `graphql:"dismissedAt"`
				FixedAt     *githubv4.DateTime `graphql:"fixedAt"`
				Repository  *struct {
					Name  *githubv4.String `graphql:"name"`
					Owner *struct {
						Login *githubv4.String `graphql:"login"`
					} `graphql:"owner"`
				}
				SecurityAdvisory *struct {
					ID          *githubv4.ID                       `graphql:"id"`
					Description *githubv4.String                   `graphql:"description"`
					CVSS        *CVSS                              `graphql:"cvss"`
					Permalink   *githubv4.URI                      `graphql:"permalink"`
					Severity    *githubv4.SecurityAdvisorySeverity `graphql:"severity"`
					Summary     *githubv4.String                   `graphql:"summary"`
				} `graphql:"securityAdvisory"`
				SecurityVulnerability *struct {
					FirstPatchedVersion *struct {
						Identifier *githubv4.String `graphql:"identifier"`
					}
					Package *struct {
						Ecosystem *githubv4.String `graphql:"ecosystem"`
						Name      *githubv4.String `graphql:"name"`
					} `graphql:"package"`
					VulnerableVersionRange *githubv4.String `graphql:"vulnerableVersionRange"`
					Advisory               *struct {
						CVSS    *CVSS            `graphql:"cvss"`
						Summary *githubv4.String `graphql:"summary"`
					} `graphql:"advisory"`
				} `graphql:"securityVulnerability"`
			} `graphql:"nodes"`
		} `graphql:"vulnerabilityAlerts(last: $count)"`
	} `graphql:"repository(owner: $owner, name: $name)"`
}

type CVSS struct {
	Score        *githubv4.Float  `graphql:"score"`
	VectorString *githubv4.String `graphql:"vectorString"`
}
